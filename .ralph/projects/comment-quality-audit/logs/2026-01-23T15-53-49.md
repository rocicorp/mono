# Task: Add ASCII viz where helpful

## Attempt: 1
## Status: SUCCESS

## What I Did
- Added ASCII visualization for refCount lifecycle at the ADD case (lines 148-153)
- Enhanced the EDIT case comment with a clearer state machine diagram showing the ghost row behavior (lines 283-292)
- Both visualizations show state transitions with arrows, making the refCount semantics immediately clear

## Files Changed
- packages/zql/src/ivm/view-apply-change.ts (modified)

## ASCII Visualizations Added

### ADD case (refCount lifecycle):
```
  add(A)      add(A)      remove(A)   remove(A)
    ↓           ↓            ↓           ↓
  [A:rc=1] → [A:rc=2] → [A:rc=1] → (deleted)
```

### EDIT case (ghost row behavior):
```
  Before: [A, B(rc=2), C, D]    Edit B→B' (new sort key)
          ─────┬─────                    │
  After:  [A, B(rc=1), C, B'(rc=1), D]   B stays as ghost, B' inserted
              ghost         edited
```

## Verification Output
```
 ✓ zql src/ivm/view-apply-change.test.ts (18 tests) 16ms
 ✓ zqlite-zql-test ../zql/src/ivm/view-apply-change.test.ts (18 tests) 11ms

 Test Files  2 passed (2)
      Tests  36 passed (36)
```
