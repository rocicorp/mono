{"id":"mono-12","title":"Extend PlannerConstraint to track source join IDs","description":"Change PlannerConstraint from Record\u003cstring, undefined\u003e to Record\u003cstring, {sourceJoinId?: string}\u003e to track which join contributed each constraint key. Update mergeConstraints() to preserve source information.","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-02T07:22:29.807512-05:00","updated_at":"2025-11-02T07:22:29.807512-05:00"}
{"id":"mono-13","title":"Add unique IDs to PlannerJoin instances","description":"Add id: string field to PlannerJoin. Generate unique IDs in planner-builder.ts when creating joins (e.g., using incrementing counter or AST path).","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-02T07:22:35.036431-05:00","updated_at":"2025-11-02T07:22:35.036431-05:00"}
{"id":"mono-14","title":"Update constraint propagation to tag constraints with source","description":"In planner-join.ts propagateConstraints(), tag constraints with join ID when sending to connections. Preserve source tags through constraint translation in flipped joins.","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-02T07:22:40.227115-05:00","updated_at":"2025-11-02T07:22:40.227115-05:00","dependencies":[{"issue_id":"mono-14","depends_on_id":"mono-12","type":"blocks","created_at":"2025-11-02T07:24:06.151324-05:00","created_by":"mlaw"},{"issue_id":"mono-14","depends_on_id":"mono-13","type":"blocks","created_at":"2025-11-02T07:24:06.159996-05:00","created_by":"mlaw"}]}
{"id":"mono-15","title":"Refactor connection constraint storage to track per-source","description":"Update PlannerConnection to store constraints per source: Map\u003cstring, Map\u003cstring, PlannerConstraint\u003e\u003e where outer key is branch pattern, inner key is source join ID. Add methods to query constraints by source.","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-02T07:22:45.527872-05:00","updated_at":"2025-11-02T07:22:45.527872-05:00","dependencies":[{"issue_id":"mono-15","depends_on_id":"mono-14","type":"blocks","created_at":"2025-11-02T07:24:06.168476-05:00","created_by":"mlaw"}]}
{"id":"mono-16","title":"Extend CostModelCost interface to include fanout","description":"Add optional fanOut?: number field to CostModelCost type in planner-connection.ts. This represents average child rows per parent row for the constraint.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-02T07:22:50.550693-05:00","updated_at":"2025-11-02T07:22:50.550693-05:00"}
{"id":"mono-17","title":"Implement getStat1Fanout() helper in sqlite-cost-model","description":"Add function to query sqlite_stat1 for index statistics. Parse stat column 'totalRows avgRowsPerDistinct ...' to extract fanout. Handle best-available-index selection using sqlite_master and PRAGMA index_info. Return undefined if no suitable index found.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-02T07:22:57.24808-05:00","updated_at":"2025-11-02T07:22:57.24808-05:00","dependencies":[{"issue_id":"mono-17","depends_on_id":"mono-16","type":"blocks","created_at":"2025-11-02T07:24:06.176919-05:00","created_by":"mlaw"}]}
{"id":"mono-18","title":"Integrate fanout lookup into SQLite cost model","description":"In createSQLiteCostModel(), when constraint is provided, call getStat1Fanout() and return fanout in CostModelCost. Default to undefined if no statistics available. Use default of 1.0 when fanout is undefined.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-02T07:23:02.296364-05:00","updated_at":"2025-11-02T07:23:02.296364-05:00","dependencies":[{"issue_id":"mono-18","depends_on_id":"mono-17","type":"blocks","created_at":"2025-11-02T07:24:06.1852-05:00","created_by":"mlaw"}]}
{"id":"mono-19","title":"Update PlannerConnection to store fanout per source","description":"Add #fanOuts: Map\u003cstring, number\u003e to track fanout per constraint source. Store fanout returned by cost model. Rename selectivity to filterSelectivity for clarity.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-02T07:23:07.965994-05:00","updated_at":"2025-11-02T07:23:07.965994-05:00","dependencies":[{"issue_id":"mono-19","depends_on_id":"mono-15","type":"blocks","created_at":"2025-11-02T07:24:06.193642-05:00","created_by":"mlaw"},{"issue_id":"mono-19","depends_on_id":"mono-18","type":"blocks","created_at":"2025-11-02T07:24:06.20191-05:00","created_by":"mlaw"}]}
{"id":"mono-20","title":"Add getSemiJoinSelectivity() method to PlannerConnection","description":"Implement method that takes sourceJoinId and returns 1 - (1 - filterSelectivity)^fanOut, where fanOut is looked up from #fanOuts map (default 1.0 if not found). This is the correct semi-join selectivity formula.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-02T07:23:13.448365-05:00","updated_at":"2025-11-02T07:23:13.448365-05:00","dependencies":[{"issue_id":"mono-20","depends_on_id":"mono-19","type":"blocks","created_at":"2025-11-02T07:24:06.210418-05:00","created_by":"mlaw"}]}
{"id":"mono-21","title":"Update semi-join cost estimation to use correct selectivity","description":"In planner-join.ts estimateCost() for semi-joins, replace child.selectivity with child.getSemiJoinSelectivity(this.id) in the returnedRows calculation. Keep using filterSelectivity for flipped joins (child is outer loop).","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-02T07:23:19.787289-05:00","updated_at":"2025-11-02T07:23:19.787289-05:00","dependencies":[{"issue_id":"mono-21","depends_on_id":"mono-20","type":"blocks","created_at":"2025-11-02T07:24:06.218865-05:00","created_by":"mlaw"}]}
{"id":"mono-22","title":"Add unit tests for constraint source tracking","description":"In planner-constraint.test.ts, add tests verifying that mergeConstraints preserves source IDs, and that constraints can be correctly tagged and retrieved by source.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-02T07:23:24.737273-05:00","updated_at":"2025-11-02T07:23:24.737273-05:00","dependencies":[{"issue_id":"mono-22","depends_on_id":"mono-15","type":"blocks","created_at":"2025-11-02T07:24:10.776846-05:00","created_by":"mlaw"}]}
{"id":"mono-23","title":"Add unit tests for fanout lookup from sqlite_stat1","description":"In sqlite-cost-model.test.ts, add tests for getStat1Fanout(): test exact index match, prefix match, no index found, composite constraints with partial indexes, and stat parsing.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-02T07:23:29.953938-05:00","updated_at":"2025-11-02T07:23:29.953938-05:00","dependencies":[{"issue_id":"mono-23","depends_on_id":"mono-18","type":"blocks","created_at":"2025-11-02T07:24:10.786399-05:00","created_by":"mlaw"}]}
{"id":"mono-24","title":"Add integration tests for semi-join selectivity","description":"In planner-join.test.ts and planner-builder.test.ts, add tests with real sqlite_stat1 data showing that semi-join selectivity uses fanout factor. Test multiple joins to same connection, composite constraints, and cost comparisons.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-02T07:23:35.201509-05:00","updated_at":"2025-11-02T07:23:35.201509-05:00","dependencies":[{"issue_id":"mono-24","depends_on_id":"mono-21","type":"blocks","created_at":"2025-11-02T07:24:10.794979-05:00","created_by":"mlaw"}]}
{"id":"mono-25","title":"Update README.md with fanout factor documentation","description":"In packages/zql/src/planner/README.md, add section explaining fanout factors: how they're computed from sqlite_stat1, how they affect semi-join selectivity, and the formula. Update examples to show the impact.","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-02T07:23:40.022037-05:00","updated_at":"2025-11-02T07:23:40.022037-05:00","dependencies":[{"issue_id":"mono-25","depends_on_id":"mono-21","type":"blocks","created_at":"2025-11-02T07:24:10.803302-05:00","created_by":"mlaw"}]}
{"id":"mono-26","title":"Update SELECTIVITY_PLAN.md to mark fanout implementation complete","description":"Update packages/zql/src/planner/SELECTIVITY_PLAN.md to indicate that fanout factors have been implemented. Document the approach taken and any deviations from the original plan.","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-02T07:23:45.141204-05:00","updated_at":"2025-11-02T07:23:45.141204-05:00","dependencies":[{"issue_id":"mono-26","depends_on_id":"mono-21","type":"blocks","created_at":"2025-11-02T07:24:10.811483-05:00","created_by":"mlaw"}]}
